<div class="container mt-5">
    <!-- Form Card -->
    <div class="card shadow-sm mb-5">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0 text-white">
                {{ isEditMode ? "Edit Instructor" : "Add Instructor" }}
            </h4>
        </div>
        <div class="card-body">
            <form
                (ngSubmit)="onSubmit()"
                #instructorForm="ngForm"
                enctype="multipart/form-data"
            >
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">First Name</label>
                            <input
                                type="text"
                                name="firstName"
                                [(ngModel)]="instructor.firstName"
                                class="form-control"
                                placeholder="Enter first name"
                                required
                                [disabled]="isEditMode"
                            />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Last Name</label>
                            <input
                                type="text"
                                name="lastName"
                                [(ngModel)]="instructor.lastName"
                                class="form-control"
                                placeholder="Enter last name"
                                required
                                [disabled]="isEditMode"
                            />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input
                                type="email"
                                class="form-control"
                                [(ngModel)]="instructor.email"
                                name="email"
                                placeholder="Email"
                                required
                                [disabled]="isEditMode"
                            />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input
                                type="text"
                                class="form-control"
                                [(ngModel)]="instructor.userName"
                                name="userName"
                                placeholder="Username"
                                required
                                [disabled]="isEditMode"
                            />
                        </div>

                        <div class="mb-3" *ngIf="!isEditMode">
                            <label class="form-label">Password</label>
                            <div class="password-field">
                                <input
                                    [type]="showPassword ? 'text' : 'password'"
                                    class="form-control"
                                    [(ngModel)]="instructor.password"
                                    name="password"
                                    placeholder="Password"
                                    required
                                />
                                <button
                                    type="button"
                                    class="password-toggle"
                                    (click)="togglePasswordVisibility()"
                                >
                                    <i
                                        [class]="
                                            showPassword
                                                ? 'fa-regular fa-eye'
                                                : 'fa-regular fa-eye-slash'
                                        "
                                    ></i>
                                </button>
                            </div>
                        </div>

                        <div class="mb-3" *ngIf="!isEditMode">
                            <label class="form-label">Confirm Password</label>
                            <input
                                [type]="showPassword ? 'text' : 'password'"
                                class="form-control"
                                [(ngModel)]="instructor.confirmPassword"
                                name="confirmPassword"
                                placeholder="Confirm Password"
                                required
                            />
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">Qualification</label>
                            <input
                                type="text"
                                name="qualification"
                                [(ngModel)]="instructor.qualification"
                                class="form-control"
                                placeholder="Enter qualification"
                                required
                            />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Experience</label>
                            <input
                                type="text"
                                class="form-control"
                                [(ngModel)]="instructor.experience"
                                name="experience"
                                placeholder="Experience"
                                required
                            />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Certification</label>
                            <input
                                type="text"
                                class="form-control"
                                [(ngModel)]="instructor.certification"
                                name="certification"
                                placeholder="Certification"
                                required
                            />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">LinkedIn Profile</label>
                            <input
                                type="url"
                                name="linkdinProfile"
                                [(ngModel)]="instructor.linkdinProfile"
                                class="form-control"
                                placeholder="Enter LinkedIn URL"
                            />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea
                                name="description"
                                [(ngModel)]="instructor.description"
                                class="form-control"
                                placeholder="Enter Description"
                                rows="3"
                            ></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Profile Picture</label>
                            <input
                                type="file"
                                class="form-control"
                                (change)="onFileSelected($event)"
                                accept="image/*"
                                #fileInput
                            />
                            <div
                                class="mt-2"
                                *ngIf="
                                    profileImagePreview ||
                                    instructor.profilePicture
                                "
                            >
                                <img
                                    [src]="
                                        profileImagePreview ||
                                        instructor.profilePicture
                                    "
                                    class="img-thumbnail"
                                    width="150"
                                    height="150"
                                    style="object-fit: cover"
                                />
                                <button
                                    type="button"
                                    class="btn btn-sm btn-outline-danger ms-2"
                                    (click)="removeImage()"
                                >
                                    <i class="fas fa-trash"></i> Remove
                                </button>
                            </div>
                        </div>

                        <div class="mb-3 form-check">
                            <input
                                type="checkbox"
                                class="form-check-input"
                                [(ngModel)]="instructor.isActive"
                                name="isActive"
                                id="isActive"
                            />
                            <label class="form-check-label" for="isActive"
                                >Is Active</label
                            >
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-end mt-3">
                    <button
                        type="button"
                        class="btn btn-secondary me-2"
                        (click)="resetForm()"
                    >
                        Reset
                    </button>
                    <button
                        type="submit"
                        class="btn btn-primary"
                        [disabled]="isSubmitting || instructorForm.invalid"
                    >
                        <span
                            *ngIf="isSubmitting"
                            class="spinner-border spinner-border-sm me-1"
                        ></span>
                        {{ isEditMode ? "Update" : "Submit" }}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Instructor Table with Pagination -->
    <div class="card shadow-sm">
        <div
            class="card-header bg-light d-flex justify-content-between align-items-center"
        >
            <h4 class="mb-0">Instructor List</h4>
            <select
                class="form-select"
                [(ngModel)]="itemsPerPage"
                (change)="onPageSizeChange()"
                style="width: 80px"
            >
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
            </select>
        </div>

        <div class="card-body">
            <div *ngIf="instructors.length === 0" class="alert alert-info">
                No instructors found.
            </div>

            <div *ngIf="instructors.length > 0">
                <div datatable class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Photo</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Qualification</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let ins of pagedInstructors">
                                <td>
                                    <img
                                        [src]="
                                            getImageUrl(
                                                ins.profilePicture || null
                                            )
                                        "
                                        class="rounded-circle"
                                        width="40"
                                        height="40"
                                        style="object-fit: cover"
                                    />
                                </td>
                                <td>{{ ins.firstName }} {{ ins.lastName }}</td>
                                <td>{{ ins.email }}</td>
                                <td>{{ ins.qualification }}</td>
                                <td>
                                    <span
                                        class="badge"
                                        [ngClass]="
                                            ins.isActive
                                                ? 'bg-success'
                                                : 'bg-secondary'
                                        "
                                    >
                                        {{
                                            ins.isActive ? "Active" : "Inactive"
                                        }}
                                    </span>
                                </td>
                                <td>
                                    <button
                                        class="btn btn-sm btn-outline-primary me-2"
                                        (click)="edit(ins)"
                                        title="Edit"
                                    >
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button
                                        class="btn btn-sm btn-outline-danger"
                                        (click)="delete(ins.id)"
                                        title="Delete"
                                    >
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pagination -->
                <nav *ngIf="totalPages > 1">
                    <ul class="pagination justify-content-center">
                        <li
                            class="page-item"
                            [class.disabled]="currentPage === 1"
                        >
                            <a
                                class="page-link"
                                (click)="setPage(1)"
                                aria-label="First"
                            >
                                <span aria-hidden="true">&laquo;&laquo;</span>
                            </a>
                        </li>
                        <li
                            class="page-item"
                            [class.disabled]="currentPage === 1"
                        >
                            <a
                                class="page-link"
                                (click)="setPage(currentPage - 1)"
                                aria-label="Previous"
                            >
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>

                        <li
                            class="page-item"
                            *ngFor="let page of visiblePages"
                            [class.active]="page === currentPage"
                        >
                            <a class="page-link" (click)="setPage(page)">{{
                                page
                            }}</a>
                        </li>

                        <li
                            class="page-item"
                            [class.disabled]="currentPage === totalPages"
                        >
                            <a
                                class="page-link"
                                (click)="setPage(currentPage + 1)"
                                aria-label="Next"
                            >
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                        <li
                            class="page-item"
                            [class.disabled]="currentPage === totalPages"
                        >
                            <a
                                class="page-link"
                                (click)="setPage(totalPages)"
                                aria-label="Last"
                            >
                                <span aria-hidden="true">&raquo;&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <div class="text-muted text-center">
                    Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to
                    {{
                        Math.min(currentPage * itemsPerPage, instructors.length)
                    }}
                    of {{ instructors.length }} entries
                </div>
            </div>
        </div>
    </div>
</div>
